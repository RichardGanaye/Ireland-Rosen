%&LaTeX
\documentclass[11pt,a4paper]{article}
\usepackage[frenchb,english]{babel}
\usepackage[applemac]{inputenc}
\usepackage[OT1]{fontenc}
\usepackage[]{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{yfonts}
\usepackage{mathrsfs}
%\input{8bitdefs}

% marges
\topmargin 10pt
\headsep 10pt
\headheight 10pt
\marginparwidth 30pt
\oddsidemargin 40pt
\evensidemargin 40pt
\footskip 30pt
\textheight 670pt
\textwidth 420pt

\def\imp{\Rightarrow}
\def\gcro{\mbox{[\hspace{-.15em}[}}% intervalles d'entiers 
\def\dcro{\mbox{]\hspace{-.15em}]}}

\newcommand{\D}{\mathrm{d}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\re}{\,\mathrm{Re}\,}
\newcommand{\ord}{\mathrm{ord}}
\newcommand{\n}{\mathrm{N}}
\newcommand{\legendre}[2]{\genfrac{(}{)}{}{}{#1}{#2}}



\title{Solutions to Ireland, Rosen ``A Classical Introduction to Modern Number Theory''}
\author{Richard Ganaye}

\begin{document}

{ \Large \bf Chapter 11} 

\paragraph{Ex. 11.1} Suppose that we may write the power series $1+a_1u +a_2u^2+\cdots$ as the quotient of two polynomials $P(u)/Q(u)$. Show that we may assume that $P(0) = Q(0) = 1$.
{\it 

}
\begin{proof}
Here $f(u) = 1+a_1u +a_2u^2+\cdots \in \C[[u]]$ is a formal series in the variable $u$.

We suppose that $f(u) = P(u)/Q(u)$, where we may assume, after simplification, that the two polynomials are relatively prime. Then $P(1)/Q(1) =1$. Write $c = P(1) = Q(1) \in F$.

If $c = 0$, then $u\mid P(u)$ and $u \mid Q(u)$. This is impossible since $P \wedge Q = 1$. So $c \ne 0$.

Define $P_1(u) = (1/c) P(u), Q_1(u) = (1/c) Q(u)$. Then $f(u) = P_1(u)/Q_1(u)$ and $P_1(0) = Q_1(0) = 1$. If we replace $P,Q$ by $P_1,Q_1$, then the pair $(P_1,Q_1)$ has the required properties.
\end{proof}

\paragraph{Ex. 11.2}{\it Prove the converse to Proposition 11.1.1.
}

\begin{proof}
If $N_s = \sum_{j=1}^e \beta_j^s - \sum_{i=1}^d \alpha_i^s,$ where $\alpha_i,\beta_j$ are complex numbers,  then
\begin{align*}
\sum_{s=1}^\infty \frac{N_s u^s}{s} &=  \sum_{j=1}^e \left( \sum_{s=1}^\infty \frac{(\beta_j u)^s}{s} \right) - \sum_{i=1}^d \left( \sum_{s=1}^\infty \frac{(\alpha_i u)^s}{s} \right)\\
&=-\sum_{j=1}^e \ln(1 - \beta_ju) + \sum_{i=1}^d \ln(1 - \alpha_i u).
\end{align*}
Here $u$ is a variable, and both members are formal polynomials in $\C[[u]]$, so we don't study convergence. Nevertheless, the left member has a radius of convergence at least $q^{-n}$, and the right member $\min_{i,j}(1/\beta_j|,1/|\alpha_i|)$.

Therefore,
$$Z_f(u) = \exp\left(\sum_{s=1}^\infty \frac{N_s u^s}{s} \right) = \prod_{j=1}^e(1 - \beta_j u)^{-1} \prod_{i=1}^d (1-\alpha_i u) = \frac{\prod_{i=1}^d (1 - \alpha_i u)}{\prod_{j=1}^e (1 - \beta_j u)}$$
is a rational fraction.
\end{proof}


\paragraph{Ex. 11.3}{\it Give the details of the proof that $N_s$ is independant of the field $F_s$ (see the concluding paragraph to section 1).
}
\begin{proof}
Suppose that $E$ and $E'$ are two fields containing $F$ both with $q^s$ elements. We first show that there is a isomorphism $\sigma : E \to E'$ which fixes the elements of $F$, by showing that that both $E$ and $E'$ are isomorphic over $F$ to $F[x]/(f(x))$ for some irreducible polynomial $f(x) \in F(x)$.

There is a primitive element $\alpha' \in E'$, i.e. such that $E' = F(\alpha')$. For example, take $\alpha'$ to be a primitive $q^s - 1$ root of unity : since $\alpha$ is a generator of $E'^*$, every element $\gamma \in E'^*$ is equal to $\alpha'^k$ for some integer $k$, thus $\gamma \in F(\alpha')$ (and $0 \in F(\alpha')$). This proves $E' \subset F(\alpha')$, and since $\alpha' \in E'$ and $F \subset E'$, $F(\alpha') \subset E'$, so $E' = F(\alpha')$.

Let $f(x) \in F[x]$ be the minimal polynomial of $\alpha'$ over $F$. Then
$$E' = F(\alpha') \simeq F(x)/(f(x)),$$
where the isomorphism $\sigma_1 : F(\alpha') \to F(x)/(f(x))$ maps $\alpha'$ to $\overline{x} = x + (f(x))$, and maps $a \in F$ on $\overline{a} = a + (f(x))$.
Since $\alpha'$ is a root of $x^{q^s} -x$, $f(x) \mid x^{q^s} - x$. 

 $E$ is a field with $q^s$ elements, so we have $x^{q^s} - x = \prod_{\alpha \in E} (x-\alpha)$. Thus $f(x) \mid \prod_{\alpha \in E} (x-\alpha)$, where $\deg(f(x)) = s \geq 1$, so $f(\alpha) = 0$ for some $\alpha \in E$. The polynomial $f$ being irreducible over $F$, $f$ is the minimal polynomial of $\alpha$ over $F$, thus $F(\alpha) \simeq F[x]/(f(x))$ is a field with $q^s$ elements. 
 Since $F(\alpha) \subset E$, and $|F(\alpha)| = |E|$, we conclude $E = F(\alpha)$, therefore
$$E = F(\alpha) \simeq F(x)/(f(x)),$$
where the isomorphism $\sigma_2 : F(\alpha) \to F(x)/(f(x))$ maps $\alpha$ to $\overline{x} = x + (f(x))$, and maps $a \in F$ on $\overline{a} = a + (f(x))$.

Then  $\sigma = \sigma_1^{-1} \circ \sigma_2 : E \to E'$ is an isomorphism, and $\sigma(a) = a$ for all $a \in F$.
 
 \bigskip
 
 We can now use the isomorphism $\sigma$ to induce a map 
 $$\overline{\sigma}
 \left\{
 \begin{array}{ccl}
 P^n(E)& \to &P^n(E')\\
 {[}\alpha_0,\ldots,\alpha_n{]} &\mapsto & {[}\sigma(\alpha_0),\ldots,\sigma(\alpha_n){]}.
 \end{array}
 \right.
 $$
 Then $\overline{\sigma}$ is injective: if $[\sigma(\alpha_0),\ldots,\sigma(\alpha_n)] = [\sigma(\beta_0),\ldots,\sigma(\beta_n)]$, then there is $\lambda \in F^*$ such that $\beta_i = \lambda \sigma(\alpha_i) = \sigma(\lambda)\sigma(\alpha_i) = \sigma(\lambda \alpha_i,\ i = 0,\ldots,n$, thus $\beta_i = \lambda \alpha_i$, which proves $[\alpha_0,\ldots,\alpha_n] = [\beta_0,\ldots,\beta_n]$.
 
 If $[\gamma_0,\ldots,\gamma_n] $ is any projective point of $P^n(E')$, then 
 $$[\gamma_0,\ldots,\gamma_n] = \overline{\sigma}([\sigma^{-1}(\gamma_0),\ldots,\sigma^{-1}(\gamma_n)]).$$ This proves that $\overline{\sigma}$ is surjective. So $\overline{\sigma}$ is a bijection.
 
 Now take $f(y_0,\ldots,y_n)\in F[y_0,\ldots,y_n]$ an homogeneous polynomial, $\overline{H}_f(E)$ the corresponding projective hypersurface in $P^n(E)$, and $\overline{H}_f(E')$  the corresponding projective hypersurface in $P^n(E')$. We show that $\overline{\sigma}(\overline{H}_f(E)) = \overline{H}_f(E')$.
 
 Since $\sigma$ is a $F$-isomorphism, $\sigma(f(\alpha_0,\ldots,\alpha_n)) = f(\sigma(\alpha_0),\ldots,\sigma(\alpha_n))\quad (\alpha_i \in E)$, and similarly $\sigma^{-1}(f(\beta_0,\ldots,\beta_n)) = f(\sigma^{-1} (\beta_0),\ldots, \sigma^{-1}(\beta_n))\quad  (\beta_i \in E')$, thus
 \begin{align*}
 {[}\alpha_0,\ldots,\alpha_n{]} \in  \overline{H}_f(E)
 &\Rightarrow f(\alpha_0,\ldots,\alpha_n) = 0 \\
 &\Rightarrow \sigma(f(\alpha_0,\ldots,\alpha_n)) = \sigma(0) = 0\\
 & \Rightarrow f(\sigma(\alpha_0),\ldots,\sigma(\alpha_0)) = 0\\
 &\Rightarrow \overline{\sigma}([\alpha_0,\ldots,\alpha_n]) = [\sigma(\alpha_0),\ldots,\sigma(\alpha_0)] \in \overline{H}_f(E').
\end{align*}
This shows $\overline{\sigma}(\overline{H}_f(E)) \subset \overline{H}_f(E')$.

Conversely, 
 \begin{align*}
 {[}\beta_0,\ldots,\beta_n{]} \in  \overline{H}_f(E')
 &\Rightarrow f(\beta_0,\ldots,\beta_n) = 0 \\
 &\Rightarrow \sigma^{-1}(f(\beta_0,\ldots,\beta_n)) = \sigma(0) = 0\\
 & \Rightarrow f(\sigma^{-1}(\beta_0),\ldots,\sigma^{-1}(\beta_0)) = 0\\
 &\Rightarrow \overline{\sigma}^{-1}([\beta_0,\ldots,\beta_n]) = [\sigma^{-1}(\beta_0),\ldots,\sigma^{-1}(\beta_0)] \in \overline{H}_f(E).
\end{align*}
If we define $\alpha_i = \sigma^{-1}(\beta_i),\ i=0,\ldots,n$, then $[\alpha_0,\ldots,\alpha_n] \in \overline{H}_f(E)$, and $[\beta_0,\ldots,\beta_n] = \overline{\sigma}([\alpha_0,\ldots,\alpha_n]) \in \overline{\sigma}(\overline{H}_f(E))$. This shows $ \overline{H}_f(E') \subset \overline{\sigma}(\overline{H}_f(E))$, and so
$$\overline{\sigma}(\overline{H}_f(E)) = \overline{H}_f(E').$$
Since $\overline{\sigma}$ is a bijection,
$$N_s = |\overline{H}_f(E)| = |\overline{H}_f(E') = N'_s.$$
So $N_s$ is independent of the choice of the extension $F_s = \F_{q^s}$ of $F = \F_q$.
\end{proof}


\paragraph{Ex. 11.4}{\it Calculate the zeta function of $x_0 x_1 - x_2 x_3 = 0$ over $\F_p$.
}
\begin{proof}
Here $F = \F_p$, and $F_s = \F_{p^s}$.

To calculate $N_s$, we calculate the number of points at infinity (such that $x_0 = 0$), and the numbers of affine points of the curve $\overline{H}_f(\F_{p^s})$ associate to $$f(x_0,x_1,x_2,x_3) = x_0 x_1 - x_2 x_3.$$
\begin{enumerate}
\item[$\bullet$] To estimate le number of points at infinity, we calculate first the cardinality of the set
$$U = \{(\alpha_0,\alpha_1,\alpha_2,\alpha_3) \in F_s^4 \mid \alpha_0 \alpha_1 - \alpha_2  \alpha_3 =0,\ \alpha_0 = 0\}.$$ 

Then $\alpha_1$ takes an arbitrary value $a \in F_s$. Write
$$U_a =\{(\alpha_0,\alpha_1,\alpha_2,\alpha_3) \in U \mid  \alpha_1 = a\}.$$
Then $U_a =\{(\alpha_0,\alpha_1,\alpha_2,\alpha_3) \in  F_s^4\mid  \alpha_0 = 0,\ \alpha_1 = a,\ \alpha_2\alpha_3 = 0\}$ , thus $U_a = A \cup B$, where 
\begin{align*}
A &= \{(\alpha_0,\alpha_1,\alpha_2,\alpha_3) \in U_a \mid \alpha_2 = 0\},\\
B &= \{(\alpha_0,\alpha_1,\alpha_2,\alpha_3) \in U_a \mid \alpha_3 = 0\}.
\end{align*}
Since $\alpha_0,\alpha_1,\alpha_3$ are fixed in $A$, the map $A \to F_s$ defined by $(\alpha_0,\alpha_1,\alpha_2,\alpha_3) \mapsto \alpha_3$ is a bijection, therefore $|A| = p^s$, and similarly $|B| = p^s$. But $A\cap B = \{(0,0,0,0)\}$, thus 
$$|U_a| = |A| + |B| - |A\cap B| = 2p^s - 1.$$
Since $U$ is the disjoint union of the $U_a$, thus
$$|U| = \sum_{a\in F_s} |U_a| = \sum_{a\in F_s} (2p^s - 1) = 2p^{2s} - p^s .$$
Therefore the number of projective points $[\alpha_0,\alpha_1,\alpha_2,\alpha_3] \in P^3(F_s)$ at infinity (such that $\alpha_0 = 0$) is
$$N_\infty = \frac{|U|-1}{p^s-1} =\frac{ 2p^{2s} - p^s -1}{p^s-1} = 2p^s+1.$$

\item[$\bullet$] Now we calculate the number of points of the affine surface $H_f(\F_s)$ associate to the equation $y_1 = y_2 y_3$ (where $y_i = x_i/x_0$).

The maps 
$$
u
\left\{
\begin{array}{ccl}
F_s^2 & \to & H_f(F_s)\\
(\beta, \gamma) & \mapsto &(\beta \gamma, \beta, \gamma)
\end{array}
\right.
\qquad
\left\{
\begin{array}{ccl}
H_f(F_s) & \to & F_s^2\\
(\alpha,\beta, \gamma) & \mapsto & ( \beta, \gamma)
\end{array}
\right.
$$
satisfy $u \circ v = \mathrm{id}, v\circ u = \mathrm{id}$, so $u$ is a bijection. With more informal words, the arbitrary choice of $\beta, \gamma \in F_s$ gives the affine point $(\alpha,\beta,\gamma)$, where $\alpha = \beta \gamma$.

This gives $|H_f(F_s)| = p^{2s}$.
\end{enumerate}
Therefore
$$N_s = |\overline{H}_f(F_s)| = p^{2s} + 2p^s + 1.$$
We obtain in $\C[[u]]$
\begin{align*}
\sum_{s=1}^\infty \frac{N_s u^s}{s} &= \sum_{s=1}^\infty \frac{(p^2u)^{s}}{s} + 2 \sum_{s=1}^\infty \frac{(pu)^{s}}{s} + \sum_{s=1}^\infty \frac{u^{s}}{s}\\
&= -\ln(1- p^2 u) - 2\ln(1-pu) - \ln(1-u).
\end{align*}
This gives
$$Z_f(u) = (1-p^2u)^{-1}(1-pu)^{-2}(1-u)^{-1}.$$

\bigskip

Note: The result for $N_s$ is verified with the naive and very slow following code in Sage:
\begin{verbatim}

def N(p,s):
    Fs = GF(p^s)
    counter = 0
    for x in Fs:
        for y in Fs:
            for z in Fs:
                for t in Fs:
                    if x*y == z*t:
                        counter += 1
    return (counter - 1)//(p^s - 1)

p, s = 5, 3
print N(p,s), p^(2*s) + 2*p^s +1
\end{verbatim}
\begin{center}
15876 15876
\end{center}
There is a misprint in the ``Selected Hints for the Exercises'' in Ireland-Rosen p.371.
\end{proof}

\paragraph{Ex. 11.5}{\it Calculate as explicitly as possible the zeta function of $a_0x_0^2+a_1x_1^2+\cdots+a_nx_n^2$ over $\F_q$, where $q$ is odd. The answer will depend on wether $n$ is odd or even and whether $q\equiv 1 \pmod 4$ or $q \equiv 3 \pmod 4$.
}

\begin{proof}
Since $q$ is odd, there is a unique character $\chi$ of order 2 over $F = \F_q$, and a unique character of order 2 over $F_s = \F_{q^s}$ . We first compute the number in $\F_q^{n+1}$ of solutions of the equation $f(x_0,\ldots,x_n) = 0$, where $f(x_0,\ldots,x_n) = a_0x_0^2+\cdots+a_n x_n^2\in F[x_0,\ldots,x_n]$.
\begin{align*}
N(a_0x_0^2+\cdots+a_n x_n^2=0)&=\sum\limits_{a_0u_0+\cdots+a_n u_n=0}N(x_0^2=u_0)\cdots N(x_n^2=u_n)\\
&=\sum\limits_{a_0u_0+\cdots+a_n u_n=0}(1+\chi(u_0))\cdots(1+\chi(u_n)) \\
&=\sum\limits_{v_0+\cdots+v_n=0}(1+\chi(a_0)^{-1}\chi(v_0))\cdots(1+\chi(a_n^{-1})\chi(v_n)) \hspace{0.5cm}(v_i = a_i u_i)\\
&=q^{n} + \chi(a_0^{-1})\cdots\chi(a_n^{-1})J_0(\chi,\chi,\cdots,\chi),
\end{align*}
Indeed $J_0(\varepsilon,\ldots,\varepsilon) = q^{l-1}$, and $J_0(\chi_0,\ldots,\chi_n)= 0$ if some but not all of the $\chi_i$ are trivial (generalization of Proposition 8.5.1).

We estimate $J_0(\chi,\ldots,\chi)$, where there are $n+1$ entries of $\chi$.

\begin{enumerate}
\item[$\bullet$] If $n$ is even, then $\chi^{n+1} = \chi \ne \varepsilon$, thus $J_0(\chi,\ldots,\chi) = 0$ (Proposition 8.5.1(d)), and so
$$N(a_0x_0^2+\cdots+a_n x_n^2=0) = q^{n},$$
and the number of projective points on the hypersurface is given by 
$$N_1 = \frac{q^n -1}{q-1} = q^{n-1} + \cdots + q + 1.$$
\item[$\bullet$] If $n$ is odd, then $\chi^{n+1} = \varepsilon$, thus $J_0(\chi,\ldots,\chi) = \chi(-1)(q-1) J(\chi,\ldots,\chi)$, with $n$ entries of $\chi$ (same Proposition).

By Theorem 3 of chapter 8,
$$J(\chi,\ldots,\chi) = \frac{g(\chi)^n}{g(\chi)} = g(\chi)^{n-1}.$$
Since $g(\chi)^2 = g(\chi) g(\chi)^{-1}= \chi(-1)q$ (Exercise 10.22), 
\begin{align*}
\frac{1}{q-1} \, J_0(\chi,\ldots,\chi) &= \chi(-1)g(\chi)^{n-1}\\
&= \chi(-1) g(\chi)^{n-1}\\
&=\frac{\chi(-1) g(\chi)^{n+1}}{g(\chi)^2}\\
&= \frac{1}{q}\,  g(\chi)^{n+1}.
 \end{align*}
 Therefore
 $$N(a_0x_0^2+\cdots+a_n x_n^2=0)  = q^n + \chi(a_0)^{-1}\cdots \chi(a_n)^{-1} \frac{q-1}{q} g(\chi)^{n_1},$$
 and 
 $$N_1 = q^{n-1} + \cdots + q + 1 + \frac{1}{q} \chi(a_0)^{-1}\cdots \chi(a_n)^{-1}g(\chi)^{n+1}.$$
\end{enumerate}
To conclude this first part,
$$
\begin{array}{ll}
N_1 = q^{n-1} + \cdots + q + 1 &\text{if  $n$ is even},\\
N_1 = q^{n-1} + \cdots + q + 1 + \frac{1}{q} \chi(a_0)^{-1}\cdots \chi(a_n)^{-1}g(\chi)^{n+1}& \text{if $n$ is odd}.
\end{array}
$$
To compute $N_s$, we must replace $q$ by $q^s$ and $\chi$ by $\chi_s$, the character of order $2$ on $F_s$. Then
$$
\begin{array}{ll}
N_s = q^{s(n-1)} + \cdots + q^s + 1 &\text{if  $n$ is even},\\
N_s = q^{s(n-1)} + \cdots + q^s + 1 + \frac{1}{q^s} \chi_s(a_0)^{-1}\cdots \chi_s(a_n)^{-1}g(\chi_s)^{n+1}& \text{if $n$ is odd}.
\end{array}
$$
(These two results can also be obtained by using the equations (1) and (2) in Theorem 2 of Chapter 10.)
\bigskip

It remains to study $\chi_s$ in the odd case. 

Since $\chi_s^2 = \varepsilon$, for all $\alpha \in F_s$, $\chi_s(\alpha)^{-1} = \chi_s(\alpha)$, and $\chi_s(\alpha) = -1 \in \C$ if $\alpha^\frac{q^s - 1}{2} = -1 \in F_s, \chi_s(\alpha) = 1$ otherwise.

If $a \in F$, $a^\frac{q-1}{2} = \pm 1 = \varepsilon$. Since $q$ is odd, $1+q+\cdots+q^{s-1} \equiv s \pmod 2$, thus
$$a^{\frac{q^s-1}{2}} = a^{\frac{q-1}{2} (1+q+\cdots + q^{s-1})} =\varepsilon^{1+q+\cdots + q^{s-1}} = \varepsilon^{s},$$
so
$$\chi_s(a) = \chi(a)^s \qquad (a \in F).$$
We know that $g(\chi_s)^2 = \chi_s(-1) q^s$ (Ex. 10.22), thus, as $n$ is odd,
\begin{align*}
g(\chi_s)^{n+1} &= \left[g(\chi_s)^2 \right]^{\frac{n+1}{2}}\\
&=\chi_s(-1)^\frac{n+1}{2} q^{s \frac{n+1}{2}}.
\end{align*}

If $q\equiv 1 \pmod 4$, then $(-1)^{\frac{q-1}{2}} = 1$, so $-1$ is a square in $\F_q$. In this case, $-1$ is a square in $\F_{q^s}$, and $\chi_s(-1) = 1$ for all $s\geq 1$.
In this case, using $a_i \in F$,
\begin{align*}
N_s &= q^{s(n-1)} + \cdots + q^s + 1 + \chi_s(a_0)\cdots \chi_s(a_n)q^{s\frac{n-1}{2}}\\
&= q^{s(n-1)} + \cdots + q^s + 1 + [\chi(a_0)\cdots \chi(a_n)]^s q^{s\frac{n-1}{2}}
\end{align*}

If $q\equiv -1 \pmod 4$, then $\chi(-1) = (-1)^{\frac{q-1}{2}} = -1$, and
\begin{align*}
\chi_s(-1) &=\chi(-1)^s = (-1)^s,
\end{align*}
thus 
$$\frac{1}{q^s} g(\chi_s)^{n+1} = (-1)^{s \frac{n+1}{2}}q^{s \frac{n-1}{2}}.$$
This gives for odd integers $n$, and $q \equiv -1 \pmod 4$,
\begin{align*}
N_s &= q^{s(n-1)} + \cdots + q^s + 1 +  (-1)^{s \frac{n+1}{2}} \chi_s(a_0)\cdots \chi_s(a_n) q^{s \frac{n-1}{2}}\\
&=  q^{s(n-1)} + \cdots + q^s + 1 +  [(-1)^{ \frac{n+1}{2}} \chi(a_0)\cdots \chi(a_n)]^s q^{s \frac{n-1}{2}}.
\end{align*}


To collect all these cases, we have proved
$$
\begin{array}{ll}
N_s = q^{s(n-1)} + \cdots + q^s + 1 &\text{if  } n\equiv 0 \pod 2,\\
N_s = q^{s(n-1)} + \cdots + q^s + 1 + \phantom{(-1)^{ \frac{n+1}{2}}}[\chi(a_0)\cdots \chi(a_n)]^s\, q^{s\frac{n-1}{2}} &\text{if } n \equiv 1 \pod 2, q \equiv +1 \pod 4,\\
N_s = q^{s(n-1)} + \cdots + q^s + 1 +[(-1)^{ \frac{n+1}{2}} \chi(a_0)\cdots \chi(a_n)]^s\, q^{s \frac{n-1}{2}}& \text{if }n \equiv 1 \pod 2, q \equiv -1 \pod 4.
\end{array}
$$
If $n$ is even this gives, as in paragraph 1, 
$$Z_f(u)  = (1-q^{n-1}u)^{-1}\cdots (1-qu)^{-1}(1-u)^{-1}.$$


In the case $n \equiv 1 \pod 2, q \equiv +1 \pod 4$, we write for simplicity $\varepsilon = \chi(a_0)\cdots \chi(a_n) =\pm 1$.
Then 
\begin{align*}
\sum_{s=1}^\infty \frac{N_su^s}{s} &= \sum_{m=0}^{n-1}\left( \sum_{s=1}^\infty \frac{(q^m u)^s}{s} \right) + \sum_{s=1}^\infty \frac{ (\varepsilon q^\frac{n-1}{2} u)^s}{s}\\
&=  - \sum_{m=0}^{n-1} \ln(1-q^m u) -  \ln(1- \varepsilon q^\frac{n-1}{2}u).
\end{align*}
Therefore
$$Z_f(u) = \left[\prod_{m=0}^{n-1} (1 -q^mu)^{-1}\right] (1 - \chi(a_0)\cdots \chi(a_n) q^\frac{n-1}{2}u)^{-1}.$$
(Same calculation in the last case, with $\varepsilon = (-1)^{ \frac{n+1}{2}} \chi(a_0)\cdots \chi(a_n)$.)

We obtain
$$
\begin{array}{ll}
Z_f(u) = P(u)&\text{if  } n\equiv 0 \pod 2,\\
Z_f(u) = P(u)(1 - \phantom{ (-1)^\frac{n+1}{2}}\chi(a_0)\cdots \chi(a_n) q^\frac{n-1}{2}u)^{-1}&\text{if } n \equiv 1 \pod 2, q \equiv +1 \pod 4,\\
Z_f(u) = P(u)(1 - (-1)^\frac{n+1}{2}\chi(a_0)\cdots \chi(a_n) q^\frac{n-1}{2}u)^{-1}& \text{if }n \equiv 1 \pod 2, q \equiv -1 \pod 4,
\end{array}
$$
where $P(u) =  (1-q^{n-1}u)^{-1}\cdots (1-qu)^{-1}(1-u)^{-1}.$

(These results are consistent with the example $N_s = q^{2s} + q^s + 1 +\chi_s(-1) q^s$ given in paragraph 1 for the surface defined by $-y_0^2 + y_1^2 + y_2^2 + y_3^2 =0$, where $n=3$ is odd.
\begin{align*}
Z_f(u) &= (1-q^2u)^{-1}(1-qu)^{-1}(1-u)^{-1} (1 - \chi(-1) qu)^{-1}\\
&=
\left\{
\begin{array}{ll}
(1-q^2u)^{-1}(1-qu)^{-2}(1-u)^{-1}  & \text{if } q \equiv 1 \pmod 4,\\
(1-q^2u)^{-1}(1-qu)^{-1}(1-u)^{-1}(1+qu)^{-1} & \text{if } q \equiv -1 \pmod 4.)\\
\end{array}
\right.
\end{align*}
\end{proof}


\paragraph{Ex. 11.6}{\it Consider $x_0^3 + x_1^3 + x_2^3 = 0$ as an equation over $F_4$, the field with four elements. Show that there are nine points on the curve in $P^2(F_4)$. Calculate the zeta function. [Answer: $(1+2u)^2/((1-u)(1-4u))$.]
}

\begin{proof}
Since $q=4 \equiv 1 \pmod 3$, we can apply Theorem 2 of Chapter 10. Let $\chi$ be a character of order 3 over $F=\F_4$. The only other character of order $3$ is then $\chi^2$. Thus

\begin{align*}
N_1 &= q+1 + \frac{1}{q-1}  \sum_{i,j,k} J_0(\chi^i,\chi^j,\chi^k),
\end{align*}
where the sum is over all $(i,j,k) \in \{1,2\}^3$ such that $i+j+k \equiv 0 \pmod 3$, that is $(1,1,1)$ and $(2,2,2)$. Thus
\begin{align*}
N_1& = q +1 + \frac{1}{q-1} \left(J_0(\chi,\chi,\chi) + J_0(\chi^2,\chi^2,\chi^2)\right).
\end{align*}
Using $\frac{1}{q-1}\,  J_0(\chi^k,\chi^k,\chi^k) = \frac{1}{q}\, g(\chi^k)^3$ for $k=1,2$, we obtain
\begin{align*}
N_1&=q +1 + \frac{1}{q}\left ( g(\chi)^3 + g(\chi^2)^3\right).
\end{align*}
Consider $\F_4 = \F_2[x]/(x^2+x+1)$, where $a = \overline{x} = x + (x^2+x+1)$ is a generator of $\F_4^*$. Then  $\F_4 = \{0,1,a,a^2 = a+1\}$.
We compute $g(\chi)$ for the character $\chi$ of order $3$ defined by
$$
\begin{array}{c|cccc|}
t & 0 & 1 & a & a^2\\
\hline
\chi(t) & 0 & 1 & \omega & \omega^2
\end{array}
$$
where $\omega = e^\frac{2i\pi}{3}$. 

for each $t\in \F_4$, $\mathrm{tr}(a) = a+ a^2 \in \F_2$, so the traces are $\mathrm{tr}(1) = 1 + 1 = 0, \mathrm{tr}(a) = a+a^2 = 1, \mathrm{tr}(a^2) = a^2 + a^4 = a^2 + a = 1$. Therefore
\begin{align*}
g(\chi) &= \sum_{t \in \F_4} \chi(t) \zeta_2^{\mathrm{tr}(t)}\\
&= \sum_{t \in \F_4} \chi(t) (-1)^{\mathrm{tr}(t)}\\
&= 1 - \omega - \omega^2\\
&= 2.
\end{align*}
(This is in accordance with $|g(\chi)| = q^{1/2} = 2$.)
Then $g(\chi^2) = g(\chi^{-1}) = \chi(-1) \overline{g(\chi)} = g(\chi) = 2$. Therefore
\begin{align*}
N_1 &= q +1 + \frac{1}{q} g(\chi)^3 + \frac{1}{q} g(\chi^2)^3\\
&= 5 + \frac{1}{4}( 8 + 8)\\
&= 9.
\end{align*} 
There are nine points on the curve with equation $x_0^3 + x_1^3 + x_2^3 = 0$ in $P^2(F_4)$ (this is verified with a naive program in Sage).

Now we compute $N_s$. We must replace $q =4$ by $q^s = 4^s$, and $\chi$ by $\chi_s$, a character with order 3 on $F_s = \F_{4^s}$.

We obtain
$$N_s = q^s + 1 + \frac{1}{q^s} \left (g(\chi_s)^3 + g(\chi_s^2)^3 \right).$$

Now we compute $g(\chi_s)^3$. By the generalization of Corollary of Proposition 8.3.3., 
$$g(\chi_s)^3 = q^s J(\chi_s,\chi_s),$$
thus
$$N_s = q^s + 1 +  J(\chi_s,\chi_s) + J(\chi_s^2,\chi_s^2) .
$$
We know that $|J(\chi_s,\chi_s)|^2 = q^s = 4^s$ (generalization of Corollary of Theorem 1). Writing $J(\chi_s,\chi_s) = a+ b \omega,\ a,b\in \Z$, we search the solutions of
$$|a+ b \omega|^2 = a^2 - ab + b^2 = 4^s.$$
Since $\Z[\omega]$ is a PID, the factorization in primes is unique. Here $2$ is a prime element of $\Z[\omega]$, and $(a+b \omega)(a+b \omega^2) = 2^{2s}$, therefore $a+b \omega =\varepsilon 2^k, a+b \omega^2 = \zeta 2^l$, where $l,k \in \N$ and $\varepsilon, \zeta$ are units. Moreover $2^k = |a+ b \omega| = |a+b \omega^2| = 2^l$, so $k = l = s$. This shows that every solution $a+ b \omega$ of $|a+ b \omega|^2  =4^s$ is associated to $2^s$:
$$|a+ b \omega|^2  =4^s \iff a+b \omega \in \{-2^s, -1 - 2^s \omega, -2^s \omega, 2^s, 1 + 2^s \omega, 2^s \omega\}.$$

Moreover, we know that $a \equiv -1 \pmod 3,\ b \equiv 0 \pmod 3$ (generalization of Proposition 8.3.4.). Therefore $$J(\chi_s,\chi_s) = a + b \omega = -(-2)^s,$$
and similarly $J(\chi_s^2,\chi_s^2) = -(-2)^s$.  This gives
$$N_s = 4^s + 1 -2 (-2)^{s}.$$
For $s = 1$, we find anew $N_1 = 9$.

Then 
\begin{align*}
\sum_{s=1}^\infty \frac{N_s u^s}{s} &= \sum_{s=1}^\infty \frac{(4u)^s}{s}  + \sum_{s=1}^\infty \frac{u^s}{s} - 2 \sum_{s=1}^\infty \frac{(-2u)^s}{s}\\
&= - \ln(1-4u) - \ln(1-u) + 2 \ln(1+2u).\\
\end{align*}
This gives
$$Z_f(u) = \frac{(1+2u)^2}{(1-4u)(1-u)}.$$
This is the first example where $Z_f$ has a zero, which satisfies the Riemann hypothesis for curves.
\end{proof}

\paragraph{Ex. 11.7}{\it Try this exercise if you know a little projective geometry. Let $N_s$ be the number of lines in $P_n(F_{p^s})$. Find $N_s$ and calculate $\sum_{s=1}^\infty N_su^s/s$. (The set of lines in projective space form an algebraic variety calles a Grassmannian variety. So do the set of planes three-dimensinal linear subspaces, etc.)
}
\begin{proof}
Write $q = p^s$. The set of lines in $P_n(F_{q})$ is in bijective correspondence with the set of planes of the vector space $F_q^{n+1}$. To count these planes, consider the set $A$ of  linearly independent pairs$(u,v)$ of the space $F_q^{n+1}$, and $B$ the set of planes of $F_q^{n+1}$, and
$$
f 
\left\{
\begin{array}{ccl}
A & \to B \\
(u,v) & \mapsto \langle u, v \rangle.
\end{array}
\right.
$$
 The set of pre-images of a fixed plane $P$ in $B$ is the set of basis of this plane $P$. Thus, to obtain $N_s$, we divides the number of linearly independent pairs$(u,v)$ of the space by the number of basis of a fixed plane. To build such a pair, we choose first a nonzero vector $u$, and then a vector $v$ not on the line generated by $u$. Therefore
\begin{align*}
N_s &= \frac{(q^{n+1} - 1)(q^{n+1}- q)}{(q^2 - 1)(q^2 -q)}\\
&= \frac{(q^{n+1} - 1)(q^{n}- 1)}{(q^2 - 1)(q -1)}.
\end{align*}
\end{proof}

$\bullet$ If $n = 2m+1$ is odd, then
\begin{align*}
N_s &= \frac{q^{2m+2}-1}{q^2-1} \cdot \frac{q^{2m+1}-1}{q-1}\\
&=\sum_{k=0}^m q^{2k} \sum_{l = 0}^2 q^l\\
&=\sum_{k=0}^m \sum_{l = 0} ^{2m} q^{2k+l}\\
&=\sum_{r=0}^{4m} a_r q^r \qquad (r= 2k+l),
\end{align*}
where $a_r$ is the cardinality of the set
$$A_r = \{(k,l) \in \gcro 0, m \dcro \times \gcro 0, 2m \dcro \mid 2k+l = r\}.$$
%Therefore
%\begin{align*}
%\sum_{s=1}^\infty \frac{N_s u^s}{s} &= \sum_{k = 0}^m \sum_{l=0}^{2m} \frac{(p^{2k+l} u)^s}{s}\\
%&= -  \sum_{k = 0}^m \sum_{l=0}^{2m}  \ln(1-p^{2k+l} u).
%\end{align*}
We note that $0 \leq l = r-2k \leq 2m$ gives 
$$
\left\{
\begin{array}{rcl}
\frac{r}{2} - m \leq &k& \leq \frac{r}{2},\\
0 \leq &k& \leq m,
\end{array}
\right.
$$
that is
\begin{align}
\max\left( 0,  \frac{r}{2}  - m \right) \leq k \leq \min \left(\frac{r}{2} ,m \right),
\end{align}
 and each such $k$ gives a unique pair $(k,l) = (k,r-2k)$ in $A_r$.

\begin{enumerate}
\item[$-$] If $0 \leq r \leq 2m$, then $(1) \iff 0 \leq k \leq \frac{r}{2}$, thus $a_r = \left \lfloor \frac{r}{2} \right \rfloor + 1$.
\item[$-$] If $2m < r \leq 4m$, then $(1) \iff \frac{r}{2} -m  \leq k \leq m$, thus $a_r = 2m - \left \lceil \frac{r}{2} \right \rceil + 1$.
\end{enumerate}
If $n$ is odd, we have proved that
\begin{align*}
N_s &= \sum_{r=0}^{2m} \left (\left \lfloor \frac{r}{2} \right \rfloor + 1 \right) q^r + \sum_{r=2m+1}^{4m} \left(2m+1 - \left \lceil \frac{r}{2} \right \rceil \right) q^r\\
&=\sum_{r=0}^{n-1} \left (\left \lfloor \frac{r}{2} \right \rfloor + 1 \right) p^{sr} + \sum_{r=n}^{2n-2} \left (n- \left \lceil \frac{r}{2} \right \rceil  \right) p^{sr}.
\end{align*}

\bigskip

$\bullet$ If $n = 2m$ is even, then
\begin{align*}
N_s &=\frac{q^{2m}-1}{q^2-1}\cdot  \frac{q^{2m+1}-1}{q-1} \\
&= \sum_{k=0}^{m-1} q^{2k} \sum_{l = 0}^{2m} q^l\\
&=\sum_{k=0}^{m-1} \sum_{l = 0} ^{2m} q^{2k+l}\\
&=\sum_{r=0}^{4m-2} b_r q^r \qquad (r= 2k+l),
\end{align*}
where $b_r$ is the cardinality of the set
$$B_r = \{(k,l) \in \gcro 0, m-1 \dcro \times \gcro 0, 2m \dcro \mid 2k+l = r\}.$$
Here $0 \leq l = r-2k \leq 2m$ gives 
$$
\left\{
\begin{array}{rcl}
\frac{r}{2} - m \leq &k& \leq \frac{r}{2},\\
0 \leq &k& \leq m -1,
\end{array}
\right.
$$
that is
\begin{align}
\max\left( 0,  \frac{r}{2}  - m \right) \leq k \leq \min \left(\frac{r}{2} ,m-1 \right),
\end{align}
 and each such $k$ gives a unique pair $(k,l) = (k,r-2k)$ in $B_r$.
\begin{enumerate}
\item[$-$] If $0 \leq r \leq 2m-1$, then $(2) \iff 0 \leq k \leq \frac{r}{2}$, thus $b_r = \left \lfloor \frac{r}{2} \right \rfloor + 1$.
\item[$-$] If $2m \leq r \leq 4m-2$, then $(2) \iff \frac{r}{2} -m  \leq k \leq m-1$, thus $b_r = 2m - \left \lceil \frac{r}{2} \right \rceil$.
\end{enumerate}
If $n$ is odd, we have proved that
\begin{align*}
N_s &= \sum_{r = 0}^{2m-1}  \left (\left \lfloor \frac{r}{2} \right \rfloor + 1\right) q^r + \sum_{r=2m}^{4m-2} \left ( 2m - \left \lceil \frac{r}{2} \right \rceil \right) q^r\\
&= \sum_{r = 0}^{n-1}  \left (\left \lfloor \frac{r}{2} \right \rfloor + 1\right) p^{sr} + \sum_{r=n}^{2n-2} \left ( n - \left \lceil \frac{r}{2} \right \rceil \right) p^{sr}.
\end{align*}
This is the same formula as in the odd case !
To conclude, for all dimension $n$,
$$N_s = \sum_{r = 0}^{n-1}  \left (\left \lfloor \frac{r}{2} \right \rfloor + 1\right) p^{sr} + \sum_{r=n}^{2n-2} \left ( n - \left \lceil \frac{r}{2} \right \rceil \right) p^{sr},$$
therefore
$$\sum_{s=1}^\infty \frac{N_s u^s}{s} = - \sum_{r=0}^{n-1}  \left (\left \lfloor \frac{r}{2} \right \rfloor + 1 \right) \ln(1-p^ru) - \sum_{r=n}^{2n-2}  \left (n - \left \lceil \frac{r}{2} \right \rceil  \right) \ln(1 - p^r u)$$
This gives the order of the poles $p^{-r}$ of $Z(u) = \exp\left( \sum_{s=1}^\infty \frac{N_s u^s}{s}  \right)$.

To verify the equality between the two formulas giving $N_s$, we test this equality with a Sage program.
\begin{verbatim}
def N(n,p,s):
     q = p^s
     num = (q^(n+1) - 1)*(q^(n+1) - q)
     den = (q^2 - 1)*(q^2-q)
     return num // den
     
 def M(n,p,s):
    q = p^s
    a = sum((floor(r/2) +1)*q^r for r in range(n))
    b = sum((n - ceil(r/2))*q^r for r in range(n,2*n-1))
    return a+b
    
 N(4,5,3),M(4,5,3)
\end{verbatim}
\begin{center}
(3845707062626, 3845707062626)
\end{center}
\end{document}